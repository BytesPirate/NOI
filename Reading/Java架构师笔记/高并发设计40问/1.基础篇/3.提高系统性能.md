# 提高系统性能

- 高并发系统设计的三大目标：高性能、高可用、可拓展

## 高并发

- 是指运用设计手段让系统能够处理更多用户的并发请求，也就是承担更大的流量。**是一切架构设计的背景和前提**
- **性能和可用性**，是我们实现高并发系统设计必须考虑的因素
- **可拓展性**，同样是高并发系统设计必须考虑的因素

## 性能优化原则

1. 性能优化一定不能盲目，一定是问题导向的：脱离了问题，盲目地提早优化会增加系统的复杂度，浪费开发人员的时间，也因为某些优化可能会对业务上有些折中的考虑，所以也会损伤业务。
2. 性能优化也遵循“八二原则”：即可以用20%的精力去解决80%的性能问题，所以在优化的过程中一定要抓住主要矛盾，优先优化主要的性能瓶颈点。
3. 性能优化也要有数据支撑：在优化的过程中，要时刻了解优化让响应时间减少了多少，提升了多少的吞吐量。
4. 性能优化的过程是持续的：高并发的系统通常是业务逻辑相对复杂的系统，那么在这类系统中出现的性能问题通常也会有多方面的原因。因此，我们在做性能优化的时候要明确目标，比方说，支撑每秒 1 万次请求的吞吐量下响应时间在 10ms，那么我们就需要持续不断地寻找性能瓶颈，制定优化方案，直到达到目标为止。

## 性能的度量指标

对于性能我们需要有度量的标准，有了数据才能明确目前存在的性能问题，也能够用数据来评估性能优化的效果。所以，**明确性能的度量指标十分重要**。

一般来说，度量性能的指标是**系统接口的响应时间**，但是单次的响应时间是没有意义的，我们需要知道一段时间性能情况是什么样的。所以，我们需要收集这段时间的响应时间数据，依据一些统计方法计算出**特征值**，这些特征值就能够代表这段时间的性能情况，常见的性能值有以下几列：

- 平均值：平均值就是把这段时间所有请求的响应时间数据相加，再除以总请求数。平均值可以在一定程度上反应这段时间的性能，但是它的**敏感度较差**，如哦这段时间有少量慢请求时，在平均值上并不能如实反应。举个例子，假设我们在`30s`内有`10000`次请求，每次请求的响应时间都是`1ms`，那么这段时间响应时间平均值也是`1ms`。这时，当其中`100`次请求的响应时间变成了`100ms`，那么整体的响应时间是`100 * 100 + 9900 * 1) / 10000 = 1.99ms`。你看，虽然从平均值上来看仅仅增加了不到`1ms`，但是实际情况是有`1%`的请求`（100/10000）`的响应时间已经增加了`100`倍。 所以，平均值对于度量性能来说只能作为一个参考。
- 最大值：就是这段时间内所请求响应时间最长的那个值，它的**问题在于太过于敏感**了，拿上面的例子来说，如果`10000`次请求中只有一次请求的响应时间达到`100ms`，那么这段时间请求的响应耗时的最大值就是`100ms`，性能损耗为原先的百分之一，这种说法明显是不准确的。
- 分位值：
